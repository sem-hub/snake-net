* Логи сделать красивыми и цветными (https://habr.com/ru/companies/slurm/articles/798207/)
* Ревизия всех логов
* По хорошему, при получении retransmit пакета, надо снижать packet rate
* Через некоторое время пересогласование ключей.
* Улучшить stream cipher engines, чтобы ножно было использовать block ciphers в режиме CTR

Сильно далекие планы:
* При подключении клиента можно упростить handshake, если UUID уже известен серверу. Для этого, конечно,
  придется сохранять данные о клиенте некоторое время.
* когда-нибудь сделать не разделение на клиент и сервер, а просто узлы, которые могут быть и тем и другим

Подписи:
* HKDF-SHA256 (https://pkg.go.dev/golang.org/x/crypto/hkdf)
 
Шифрование с аутентификацией (AEAD):
* AES-SIV
* AES-PMAC-SIV
* AES-EAX
* AES-OCB
* AES-CCM
* AES-GCM-SIV
* SM4-GCM
* *-MGM

## Известные поточные шифры (выборка)
RC4 — исторически широко применялся; сейчас считается небезопасным (уязвимости в начальном префиксе, статистические атаки).
Spritz — попытка реинжиниринга RC4 (альтернатива от Rivest), малая популярность.
HC-128, HC-256 — словоориентированные шифры, финалисты eSTREAM.
Grain (Grain v1, Grain-128a) — ориентированы на «легковесные» устройства / IoT.
Trivium — компактный и эффективный для аппаратных реализаций (eSTREAM).
MICKEY 2.0 — лёгкий потоковый шифр (eSTREAM).

## Популярные AEAD-конструкции

### 1. На основе AES
- **AES-GCM** (Galois/Counter Mode)
  - Самый распространённый; стандарт TLS 1.2/1.3, IPsec, SSH.
  - Быстр при аппаратной поддержке (AES-NI + PCLMULQDQ).
  - 96-битный nonce (типично); критически важно не повторять nonce.
  - Уязвим при слабом nonce-менеджменте (birthday bound ~2^48 блоков с одним ключом).

- **AES-CCM** (Counter with CBC-MAC)
  - Используется в WPA2, Bluetooth, некоторых IoT-стандартах.
  - Более медленный, чем GCM (два прохода).
  - Произвольная длина nonce (7-13 байт), фиксируется заранее.
  - Требует знания длины сообщения до начала шифрования (не потоковый).

- **AES-OCB** (Offset Codebook Mode)
  - Самый быстрый AEAD на базе AES (один проход).
  - Патентные ограничения (свободен для открытых проектов).
  - Менее популярен из-за патентов, но технически превосходен.

- **AES-GCM-SIV** (Nonce Misuse-Resistant)
  - Детерминистическое/синтетическое IV: устойчив к повторению nonce.
  - Немного медленнее GCM, но безопаснее при ошибках nonce.
  - RFC 8452; растущая популярность.

- **AES-SIV** (Synthetic IV)
  - Двухпроходная конструкция (AES-CTR + AES-CMAC/PMAC).
  - Полная nonce-misuse resistance.
  - Медленнее GCM, но отказоустойчивее.

### 2. На основе ChaCha20
- **ChaCha20-Poly1305**
  - RFC 7539; стандарт TLS 1.3, WireGuard, Signal, многие VPN.
  - Быстр на CPU без AES-NI (софтверная реализация проще).
  - 96-битный nonce + 256-битный ключ.
  - Простая, безопасная конструкция.

- **XChaCha20-Poly1305**
  - Расширенный nonce (192 бита) — проще генерировать случайные nonce.
  - Используется в libsodium, NaCl-based системах.
  - Та же безопасность, что ChaCha20-Poly1305, но удобнее для случайных nonce.

### 3. На основе других потоковых шифров
- **XSalsa20-Poly1305** (NaCl `crypto_secretbox`)
  - 192-битный nonce, 256-битный ключ.
  - Старше XChaCha20, но всё ещё надёжен.
  - Применяется в libsodium, NaCl.

### 4. Лёгкие AEAD (для IoT/ограниченных устройств)
- **ASCON** (победитель NIST LWC 2023)
  - ASCON-128, ASCON-128a, ASCON-80pq.
  - Малое потребление ресурсов, аппаратно эффективен.
  - Рекомендован для IoT/встраиваемых систем.

- **Deoxys-II** (финалист CAESAR)
  - Tweakable block cipher; эффективен для аппаратных реализаций.

- **GIFT-COFB**, **Romulus**, **TinyJAMBU** (финалисты NIST LWC)
  - Разные компромиссы между размером/скоростью/памятью.

- **Grain-128AEAD**
  - Потоковый шифр + встроенная аутентификация.

### 5. Другие известные AEAD
- **AES-EAX**
  - Двухпроходная конструкция (CTR + OMAC).
  - Более гибкий nonce, чем CCM.
  - Менее популярен, чем GCM/CCM.

- **Elephant**, **PHOTON-Beetle**, **SPARKLE** (NIST LWC)
  - Для специфических аппаратных платформ.

### 6. Экспериментальные/специализированные
- **AES-AEGIS** (AEGIS-128, AEGIS-256)
  - Очень быстрый на современных CPU (AES-NI).
  - Финалист CAESAR; растущий интерес.
  
- **MORUS** (финалист CAESAR, затем отозван из-за некоторых слабостей)
  - Не рекомендуется для новых проектов.

- **COLM**, **CLOC**, **SILC** (финалисты CAESAR)
  - Специализированные конструкции; малое распространение.

## Сравнение и выбор

| Алгоритм | Скорость (с AES-NI) | Скорость (без AES-NI) | Nonce | Nonce-misuse resistant | Применение |
|----------|---------------------|----------------------|-------|------------------------|------------|
| AES-GCM | Очень быстрый | Медленный | 96 бит | Нет | TLS, IPsec, SSH |
| AES-GCM-SIV | Быстрый | Медленный | 96 бит | Да | Google, Cloudflare |
| ChaCha20-Poly1305 | Быстрый | Очень быстрый | 96 бит | Нет | TLS, WireGuard, VPN |
| XChaCha20-Poly1305 | Быстрый | Очень быстрый | 192 бит | Нет | libsodium, NaCl |
| AES-CCM | Средний | Медленный | 7-13 байт | Нет | WPA2, Bluetooth |
| AES-OCB | Очень быстрый | Средний | Гибкий | Нет | Ограничен патентами |
| ASCON | N/A (для IoT) | N/A (для IoT) | Гибкий | Нет | IoT, встраиваемые |

## Рекомендации для практики
1. **Общего назначения (VPN, файлы, сеть)**:
   - С AES-NI: **AES-GCM** или **AES-GCM-SIV** (если важна nonce-misuse resistance).
   - Без AES-NI или мобильные устройства: **ChaCha20-Poly1305** или **XChaCha20-Poly1305**.

2. **Высокая безопасность nonce-менеджмента**:
   - **AES-GCM-SIV** или **AES-SIV**.

3. **Длинные случайные nonce**:
   - **XChaCha20-Poly1305** (192 бита).

4. **IoT / встраиваемые системы**:
   - **ASCON** (NIST LWC winner).

5. **Легаси/стандарты**:
   - WPA2: **AES-CCM**.
   - TLS 1.3: **AES-GCM** или **ChaCha20-Poly1305**.

- **XChaCha20-Poly1305** — удобен для длинных nonce.
- **AES-GCM-SIV** — для nonce-misuse resistance.
- **ASCON** — если планируете поддержку IoT.